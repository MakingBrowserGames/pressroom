var prSwiper;function fixPagesHeight(){$(".swiper-pages").css({height:$("#sg-gen-container").height()});prSwiper.resizeFix()}function getNotLoadedSlide(e,f,b,a){if(b==a){return false}var c=f=="next"?e.next():e.prev();if(!c.length){return false}if(c.data("status")!="loaded"){return c}else{getNotLoadedSlide(c,f,b+1,a)}}$(function(){var a=$("#reader"),d=a.data("conpages"),e=$(".circle--left").hide(),b=$(".circle--right").hide(),c=$("#fire-toc");$.fn.lazyLoad=function(j,f,k){var g=$(this),h=g.data("status");if(h!="loaded"){return $.get(a.data("url"),{post_id:g.data("post"),edition_id:a.data("edition"),action:"preview_draw_page",pr_no_theme:true},function(i){if(i){var l=$("<iframe>",{src:i,height:"100%",width:"100%",frameborder:0});l.load(function(){var m=l.contents().find("head");m.append($("<style>body{-webkit-touch-callout: none;-webkit-user-select: none;-khtml-user-select: none;-moz-user-select: none;-ms-user-select: none;user-select: none;}</style>"))});g.data("status","loaded").children(".spinner").replaceWith(l).hide().fadeIn("slow")}}).then(function(){if(j<f-1){$n=k=="prev"?g.prev():g.next();if($n.length){$n.lazyLoad(j+1,f,k)}}})}else{if(j<f-1){$n=k=="prev"?g.prev():g.next();if($n.length){$n.lazyLoad(j+1,f,k)}}}};prSwiper=new Swiper(".swiper-pages",{mode:"horizontal",pagination:".dots",loop:false,simulateTouch:false,grabCursor:false,roundLengths:true,calculateHeight:false,paginationClickable:true,keyboardControl:true,hashNav:true,speed:500,onFirstInit:function(f){var g=window.location.hash;$item=$(g);if(!$item.length){$item=$(".swiper-slide:first");$next=$item.next();if($next.length){b.show()}$item.lazyLoad(0,d,"next")}},onSlideChangeStart:function(f,g){if(f.activeIndex==f.slides.length-1){b.hide()}else{if(f.activeIndex==0){e.hide()}else{b.show();e.show()}}$item=$(f.activeSlide());if(g=="to"){$item.lazyLoad(0,1,"next");$prev=$item.prev(),$next=$item.next();if($next.length){b.show();$next.lazyLoad(0,d,"next")}if($prev.length){e.show();$prev.lazyLoad(0,d,"prev")}}else{$next=getNotLoadedSlide($item,g,0,d-1);if($next){$next.lazyLoad(0,d,g)}}},onSlideChangeEnd:function(f){}});e.on("click",function(f){f.preventDefault();prSwiper.swipePrev()});b.on("click",function(f){f.preventDefault();prSwiper.swipeNext()});c.on("click",function(f){f.preventDefault();$("#toc").slideToggle("slow",function(){$("#toc").is(":hidden")?$("#fire-toc").removeClass("active"):$("#fire-toc").addClass("active")})});$(window).on("hashchange",function(m){var k=document.location.hash;if(k.match("^#toc-")){k=k.replace("#toc-","item-");if(!k){return}for(var j=0;j<prSwiper.slides.length;j++){var f=prSwiper.slides[j];var l=f.data("hash");if(l===k&&f.getData("looped")!==true){var g=f.index();if(prSwiper.params.loop){g=g-prSwiper.loopedSlides}prSwiper.swipeTo(g,prSwiper.speed)}}}});fixPagesHeight()});
